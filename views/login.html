<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web-BE-P2 WAS</title>
    <link rel="stylesheet" href="index.css" />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="m-0 mx-[200px]">
    <header class="flex items-center justify-between h-16 pb-10 pt-5 px-5">
      <h1 class="text-lg font-medium" onclick="location.href='/index.html'">
        HELLO, WEB!
      </h1>
      <button
        class="bg-[#4362d0] text-white rounded-lg px-4 py-2 border-none focus:outline-none gap-2.5"
      >
        로그인/회원가입
      </button>
    </header>
    <main class="flex flex-col items-center gap-10">
      <div class="flex items-center h-36">
        <h1 class="text-3xl font-medium">로그인</h1>
      </div>
      <form
        class="flex flex-col items-center gap-4"
        action="/login"
        method="post"
      >
        <div
          class="box-border flex flex-col gap-2 border border-[#d2dae0] p-4 rounded-lg w-80"
        >
          <label for="email" class="text-sm font-medium text-[#4b5966]">
            이메일
          </label>
          <input
            type="text"
            id="email"
            name="email"
            class="border-none focus:outline-none"
            placeholder="이메일을 입력해주세요."
          />
        </div>
        <div
          class="box-border flex flex-col gap-2 border border-[#d2dae0] p-4 rounded-lg w-80"
        >
          <label for="email" class="text-sm font-medium text-[#4b5966]">
            비밀번호
          </label>
          <input
            type="password"
            id="password"
            name="password"
            class="border-none focus:outline-none"
            placeholder="비밀번호를 입력해주세요."
          />
        </div>
        <button
          id="loginButton"
          class="bg-[#4362d0] text-white rounded-lg px-2.5 py-1.5 border-none w-80 h-10 mt-6 focus:outline-none transition-colors duration-300 disabled:cursor-not-allowed enabled:hover:bg-[#14212B]"
          type="submit"
        >
          로그인
        </button>
      </form>
      <div>
        아직 회원가입을 안하셨나요?
        <span class="text-[#4362d0]">
          <a href="/form.html">회원가입하기</a>
        </span>
      </div>
    </main>
    <script>
      const emailInput = document.getElementById("email");
      const passwordInput = document.getElementById("password");
      const loginButton = document.getElementById("loginButton");
      const loginForm = document.querySelector("form");

      function checkInputs() {
        if (
          emailInput.value.trim() !== "" &&
          passwordInput.value.trim() !== ""
        ) {
          loginButton.disabled = false;
        } else {
          loginButton.disabled = true;
        }
      }

      emailInput.addEventListener("input", checkInputs);
      passwordInput.addEventListener("input", checkInputs);

      checkInputs();

      loginForm.addEventListener("submit", function (e) {
        e.preventDefault();

        const formData = {
          email: emailInput.value,
          password: passwordInput.value,
        };

        fetch("/user/login", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(formData),
          redirect: "follow", // 서버의 리다이렉트를 따르도록 설정
        })
          .then((response) => {
            if (response.ok) {
              localStorage.setItem("token", response.body.token);
              window.location.href = response.url;
            } else {
              // 로그인 실패 시 처리
              console.error("로그인 실패");
              alert("로그인에 실패했습니다. 이메일과 비밀번호를 확인해주세요.");
            }
          })
          .catch((error) => {
            console.error("에러 발생:", error);
            alert("로그인 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.");
          });
      });
    </script>
  </body>
</html>
